{% extends 'base.html' %}


{% load static %}

{% block content %}
<!-- Page Headings -->
{% if searched == '' %}
    <h3 class="col-12 text-center main-heading txt-blck flex-column m-4">
        Oops... you forgot to enter a search value...
    <img src="{% static 'images/empty.webp' %}" alt="Empty Notebook" class="img-fluid img-empty m-4 p-4">
    </h3>
{% elif not recipes %}
    <h3 class="col-12 text-center main-heading txt-blck flex-column m-4">
        Unfortunately nothing matched your search: {{searched}}
        <img src="{% static 'images/empty.webp' %}" alt="Empty Notebook" class="img-fluid img-empty m-4 p-4">
    </h3>
    {% else %}
        <h3 class="col-12 text-center main-heading txt-blck">
            You searched for recipes with {{searched}} in their title...
        </h3>
        <!-- Recipe Section -->
        <div class="col-12 md-4">
            <div class="row g-0">
                {% for recipe in recipes %}
                <div class="col-md-4 d-flex align-items-stretch">
                    <div class="card">
                        <a href="{% url 'recipe_detail' recipe.slug %}" class="recipe-link">
                        {% if 'default' in recipe.image.url %}
                            <img src="{% static 'images/logo1.webp' %}" class="card-img-top" alt="Recipe Repo logo. Recipes plus storage.">
                        {% else %}
                        <div class="image">
                            <img src="{{ recipe.image.url }}" class="img card-img-top" alt="{{recipe.image_alt}}">
                        </div>
                        </a>
                        {% endif %}
                        <div class="card-body d-flex justify-content-end flex-column">
                            <a href="{% url 'recipe_detail' recipe.slug %}" class="recipe-link">
                                <h5 class="card-title">{{recipe.title}}</h5>
                            </a>
                            <h6 class="card-subtitle mb-2 text-body-secondary">Created by {{recipe.author}}</h6>
                            
                            <!-- Tags -->
                            <div class="d-flex flex-wrap ">
                                {% for tag in recipe.tags.all %}
                                <a href="{% url 'tagged' tag.slug %}" class="tag-btn">#{{ tag }}</a>
                                {% endfor %}
                            </div>
    
                            <p class="card-text">{{ recipe.summary }}</p>
                            <hr class="mt-auto">
                            <!-- Like and Bookmarks Buttons -->
                            <div class="icons-container">
                                {% if user.is_authenticated %}
                                <form action="{% url 'recipe_like' recipe.slug %}" method="POST">
                                    {% csrf_token %}
                                    {% if request.user in recipe.likes.all %}
                                    <span>
                                        <button class="btn-like" type="submit" name="recipe_id" value="{{recipe.slug}}">
                                            <i class="fa-solid fa-heart fa-xl" style="color: #db0000;"></i>
                                        </button>
                                        {{ recipe.number_of_likes }}
                                    </span>
                                    {% else %}
                                    <span>
                                        <button class="btn-like" type="submit" name="recipe_id" value="{{recipe.slug}}">
                                            <i class="far fa-heart fa-xl"></i>
                                        </button>
                                        {{ recipe.number_of_likes }}
                                    </span>
                                    {% endif %}
                                </form>
                                <form action="{% url 'recipe_bookmark' recipe.slug %}" method="POST">
                                    {% csrf_token %}
                                    {% if request.user in recipe.bookmarks.all %}
                                    <span>
                                        <button class="btn-like" type="submit" name="recipe_id" value="{{recipe.slug}}">
                                            <i class="fa-solid fa-bookmark fa-xl"></i>
                                        </button>
                                    </span>
                                    {% else %}
                                    <span>
                                        <button class="btn-like" type="submit" name="recipe_id" value="{{recipe.slug}}">
                                            <span><i class="fa-regular fa-bookmark fa-xl"></i></span> 
                                        </button>
                                    </span>
                                    {% endif %}
                                </form>
                            {% else %}
                                <span><i class="far fa-heart fa-xl"></i> {{ recipe.number_of_likes }}</span>
                            {% endif %}
                            </div>
                            <hr>
                            <div class="card-text text-muted h6 text-center pb-1">{{recipe.published_on}}</div>
                        </div>
                    </div>
                </div>
                {% if forloop.counter|divisibleby:3 %}
                </div>
                <div class="row g-0">
                {% endif %}
                {% endfor %}
            </div>
        </div>
    
{% endif %}

{% endblock %}